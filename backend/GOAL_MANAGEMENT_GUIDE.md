# 目标管理模块使用指南

## 📋 功能概述

目标管理模块帮助用户设置、追踪和管理健康目标，支持多种目标类型和周期，自动计算完成度。

## 🎯 目标类型

系统支持以下目标类型：

| 类型 | 代码 | 说明 | 示例 |
|-----|------|------|------|
| 🏃 锻炼 | `exercise` | 运动和体能训练 | 每日运动30分钟 |
| 🥗 饮食 | `diet` | 饮食和营养 | 每日摄入蔬菜500克 |
| 😴 睡眠 | `sleep` | 睡眠质量和时长 | 保证7-8小时睡眠 |
| 💧 饮水 | `water` | 每日饮水量 | 每日饮水2000ml |
| 💊 补剂 | `supplement` | 营养补充剂 | 每日补充维生素D |
| 🌳 户外活动 | `outdoor` | 户外活动和日晒 | 每日户外活动1小时 |
| ⚖️ 体重 | `weight` | 体重管理 | 减重5公斤 |
| 📌 其他 | `other` | 其他健康目标 | 冥想、阅读等 |

## 📅 目标周期

支持四种目标周期：

- **每日** (`daily`): 每天完成的目标
- **每周** (`weekly`): 每周完成的目标
- **每月** (`monthly`): 每月完成的目标
- **每年** (`yearly`): 每年完成的目标

## 🔄 目标状态

- **进行中** (`active`): 正在进行的目标
- **已完成** (`completed`): 已经达成的目标
- **已暂停** (`paused`): 暂时停止的目标
- **已取消** (`cancelled`): 放弃的目标

## 🚀 使用方式

### 1. 命令行测试

```bash
# 进入后端目录
cd backend

# 激活虚拟环境
source venv/bin/activate

# 运行测试脚本
python scripts/test_goals.py
```

### 2. API 接口

#### 创建目标

```bash
curl -X POST "http://localhost:8000/api/v1/goals" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 1,
    "goal_type": "exercise",
    "goal_period": "daily",
    "title": "每日运动30分钟",
    "description": "保持每天至少30分钟中等强度运动",
    "target_value": 30,
    "target_unit": "分钟",
    "start_date": "2026-01-03",
    "implementation_steps": "1. 早起慢跑15分钟\n2. 晚上做力量训练15分钟",
    "priority": 8
  }'
```

#### 获取用户目标

```bash
# 获取所有目标
curl "http://localhost:8000/api/v1/goals/user/1"

# 按类型筛选
curl "http://localhost:8000/api/v1/goals/user/1?goal_type=exercise"

# 按周期筛选
curl "http://localhost:8000/api/v1/goals/user/1?goal_period=daily"

# 按状态筛选
curl "http://localhost:8000/api/v1/goals/user/1?status=active"
```

#### 更新目标进度

```bash
curl -X POST "http://localhost:8000/api/v1/goals/1/progress?progress_date=2026-01-03&progress_value=25"
```

#### 查看目标进展记录

```bash
curl "http://localhost:8000/api/v1/goals/1/progress"
```

#### 检查目标完成情况

```bash
curl "http://localhost:8000/api/v1/goals/1/completion"
```

#### AI 自动生成目标

根据健康分析结果自动生成目标：

```bash
curl -X POST "http://localhost:8000/api/v1/goals/generate-from-analysis/1"
```

### 3. 前端页面

访问 `http://localhost:3000/goals` 查看目标管理页面。

## 🎨 前端功能

### 主要功能

1. **目标列表**
   - 卡片式展示所有目标
   - 显示进度条和完成百分比
   - 按优先级和创建时间排序
   - 点击卡片查看详情

2. **创建目标**
   - 点击"新建目标"按钮
   - 填写目标信息（类型、周期、标题等）
   - 设置目标值和单位
   - 添加实现步骤
   - 设置优先级（1-10）

3. **AI 生成目标**
   - 点击"AI 生成目标"按钮
   - 系统自动分析健康问题
   - 生成相应的健康目标
   - 包含详细的实现步骤

4. **目标筛选**
   - 按类型筛选（运动、睡眠等）
   - 按周期筛选（每日、每周等）
   - 按状态筛选（进行中、已完成等）

5. **目标详情**
   - 查看完整的目标信息
   - 显示目标描述和实现步骤
   - 查看进度数据
   - 显示时间范围

## 📊 数据结构

### 目标数据模型

```python
{
  "id": 1,
  "user_id": 1,
  "goal_type": "exercise",          # 目标类型
  "goal_period": "daily",            # 目标周期
  "title": "每日运动30分钟",         # 标题
  "description": "保持每天...",      # 描述
  "target_value": 30.0,              # 目标值
  "target_unit": "分钟",             # 单位
  "current_value": 25.0,             # 当前值
  "start_date": "2026-01-03",        # 开始日期
  "end_date": "2026-02-02",          # 结束日期（可选）
  "implementation_steps": "1. ...",  # 实现步骤
  "status": "active",                # 状态
  "priority": 8,                     # 优先级 (1-10)
  "created_at": "2026-01-03T10:00:00",
  "updated_at": "2026-01-03T18:00:00"
}
```

### 进展记录模型

```python
{
  "id": 1,
  "goal_id": 1,
  "progress_date": "2026-01-03",     # 进展日期
  "progress_value": 25.0,            # 进展值
  "completion_percentage": 83.3,     # 完成百分比
  "notes": "今天跑步25分钟",          # 备注
  "created_at": "2026-01-03T18:00:00"
}
```

## 💡 最佳实践

### 1. 设置合理的目标

- **SMART原则**: 具体、可衡量、可实现、相关性、时限性
- **循序渐进**: 从小目标开始，逐步提高
- **优先级**: 重要的目标设置更高的优先级

### 2. 示例目标

#### 运动目标
```
标题: 每日步数达标
类型: 锻炼
周期: 每日
目标值: 10000
单位: 步
实现步骤:
1. 早晨散步30分钟
2. 午休时在办公室走动
3. 晚饭后散步30分钟
```

#### 睡眠目标
```
标题: 改善睡眠质量
类型: 睡眠
周期: 每日
目标值: 7.5
单位: 小时
实现步骤:
1. 晚上10:30上床
2. 早上6:00起床
3. 睡前1小时不用电子设备
4. 保持卧室温度适宜
```

#### 饮水目标
```
标题: 保持充足水分
类型: 饮水
周期: 每日
目标值: 2000
单位: ml
实现步骤:
1. 起床后喝300ml温水
2. 每2小时喝一次水
3. 运动前后补充水分
```

### 3. 追踪进度

- **每日更新**: 每天记录目标进展
- **定期回顾**: 每周/月回顾目标完成情况
- **及时调整**: 根据实际情况调整目标

### 4. 利用 AI 功能

- 使用"AI 生成目标"功能获取个性化建议
- AI 会根据你的健康数据分析结果生成目标
- 生成的目标已包含详细的实现步骤

## 🔗 相关功能

- **每日打卡**: 记录每日健康活动（与目标联动）
- **健康分析**: AI 分析健康问题（用于生成目标）
- **Garmin 数据**: 自动同步运动、睡眠等数据（自动更新目标进度）
- **仪表盘**: 可视化展示目标完成情况

## 🐛 故障排除

### 问题：无法创建目标

**解决方案**:
1. 检查必填字段（user_id, goal_type, goal_period, title, start_date）
2. 确保日期格式正确（YYYY-MM-DD）
3. 检查数据库连接

### 问题：进度更新失败

**解决方案**:
1. 确认目标 ID 存在
2. 检查 progress_value 是否为有效数字
3. 确保日期格式正确

### 问题：AI 生成目标为空

**解决方案**:
1. 确保已配置 OpenAI API Key
2. 先进行健康分析（访问 /analysis 页面）
3. 检查是否有足够的健康数据

## 📝 数据库表

目标管理使用两个主要表：

- `goals`: 存储目标信息
- `goal_progress`: 存储目标进展记录

使用 Alembic 自动管理数据库迁移。

## 🎉 总结

目标管理模块是个人健康管理系统的核心功能之一，它帮助你：

✅ 设置清晰的健康目标
✅ 追踪目标进度
✅ 获得 AI 个性化建议
✅ 保持健康习惯

开始使用目标管理，让 AI 助力你的健康自律之旅！

